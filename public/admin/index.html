<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  
  <!-- 1. 手动控制 CMS 初始化 -->
  <script>window.CMS_MANUAL_INIT = true;</script>
  
  <!-- 2. 在 Netlify Identity 小部件加载前进行配置 -->
  <script>
    window.netlifyIdentityConfig = {
      APIUrl: "https://footballposition-soccer-identity.netlify.app/.netlify/identity"
    };
  </script>
</head>
<body>
    <!-- Decap CMS 的根元素 -->
    <div id="nc-root"></div>

    <!-- 3. 加载脚本 -->
    <script src="./netlify-identity-widget.js"></script>
    <script src="./decap-cms.js"></script>

    <!-- 4. 初始化 CMS 和 Identity 事件监听器 -->
    <script>
      window.addEventListener('load', function () {
        // 初始化 CMS，它将显示登录按钮
        CMS.init();

        // Identity 小部件已通过 netlifyIdentityConfig 完成配置
        // 我们只需要处理事件
        if (window.netlifyIdentity) {
          netlifyIdentity.on('login', function (user) {
            console.log('Login successful for user:', user.email);
            // 登录后 Decap CMS 通常会自动更新
            // 再次调用 init() 可以确保同步
            CMS.init();
          });

          netlifyIdentity.on('logout', function () {
            console.log('Logged out');
          });

          netlifyIdentity.on('error', function (err) {
            console.error('Identity error:', err);
          });
        }
      });
    </script>
</body>
</html>